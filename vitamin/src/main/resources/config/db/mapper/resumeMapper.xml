<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace="kr.co.vitamin.repository.mapper.ResumeMapper">
	<resultMap type="resumeBaseInfo" id="resumeMap">
		<result column="resume_no" property="resumeNo"/>
		<result column="member_no" property="memeberNo"/>
		<result column="reg_date" property="regDate"/>
		<result column="title" property="resumeTitle"/>
		<result column="open_state" property="openState"/>
		<result column="name" property="name"/>
		<result column="birth" property="birth"/>
		<result column="address_no" property="postCode"/>
		<result column="address" property="address"/>
		<result column="phone_number" property="phoneNumber"/>
		<result column="email" property="email"/>
		<result column="gender" property="gender"/>
		<result column="job_state" property="jobState"/>
		<result column="marry_state" property="marryState"/>
		<result column="bohoon_state" property="bohoonState"/>
		<result column="support_state" property="supportState"/>
		<result column="army_service_no" property="armyServiceNo"/>
	</resultMap>
	
	
	<resultMap type="armyService" id="armyServiceMap">
		<result column="army_service_no" property="armyServiceNo"/>
		<result column="resume_no" property="resumeNo"/>
		<result column="army_service_state" property="armyServiceState"/>
		<result column="army_service_reason" property="armyServiceReason"/>
	</resultMap>
	
	<resultMap type="city" id="cityMap">
		<result column="city_code" property="cityCode"/>
		<result column="name" property="name"/>
		<result column="sub_name" property="subName"/>
	</resultMap>
	
	<resultMap type="area" id="areaMap">
		<result column="area_code" property="areaCode"/>
		<result column="city_code" property="cityCode"/>
		<result column="name" property="name"/>
	</resultMap>
	
	<resultMap type="certificate" id="certificateMap">
		<result column="certificate_no" property="certificateNo"/>
		<result column="name" property="name"/>
		<result column="licensing_department_no" property="licensingDepartmentNo"/>
	</resultMap>
	
	<resultMap type="licensingDepartment" id="licensingDepartmentMap">
		<result column="licensing_department_no" property="licensingDepartmentNo"/>
		<result column="name" property="name"/>
	</resultMap>
	
	<resultMap type="businessType" id="businessTypeMap">
		<result column="business_no" property="businessNo"/>
		<result column="business_content" property="businessContent"/>
		<result column="business_order" property="businessOrder"/>
		<result column="business_category" property="businessCategory"/>
		<result column="business_type" property="businessType"/>
	</resultMap>
	
	
	
	<insert id="insertResume" parameterType="resumeBaseInfo">
		insert into vi_resume (reg_date,title,open_state, job_state, marry_state,bohoon_state,support_state) 
				values(sysdate(),#{resumeTitle},#{openState},#{jobState},#{marryState},#{bohoonState},#{supportState})
	</insert>
	
	<insert id="insertArmyService" parameterType="armyService">
		insert into vi_army_service(resume_no,army_service_state,army_service_reason)
			values((select max(resume_no) from vi_resume),#{armyServiceState},#{armyServiceReason})
	</insert>
	
	<select id="selectResume" resultMap="resumeMap">
		select * from vi_resume
	</select>
	
	<select id="selectResumeInfo" parameterType="int" resultMap="resumeMap">
		select * from vi_resume where resume_no = #{resumeNo}
	</select>
	
	<select id="selectArmyServiceInfo" parameterType="int" resultMap="armyServiceMap">
		select * from vi_army_service where resume_no = #{resumeNo}
	</select>
	
	<select id="selectJobState" parameterType="string" resultType="string">
		select condition_section_name from vi_condition_selection where condition_type='0' and condition_section=#{jobState}
	</select>
	
	<select id="selectMarryState" parameterType="string" resultType="string">
		select condition_section_name from vi_condition_selection where condition_type='1' and condition_section=#{marryState}
	</select>
	
	<select id="selectBohoonState" parameterType="string" resultType="string">
		select condition_section_name from vi_condition_selection where condition_type='2' and condition_section=#{bohoonState}
	</select>
	
	<select id="selectSupportState" parameterType="string" resultType="string">
		select condition_section_name from vi_condition_selection where condition_type='3' and condition_section=#{supportState}
	</select>
	
	<update id="updateArmyService" parameterType="armyService">
		update vi_resume set army_service_no = (select army_service_no from vi_army_service where resume_no = #{resumeNo})
	</update>
	
	<select id="selectArmyState" parameterType="int" resultType="string">
		select condition_section_name from vi_condition_selection where condition_type='4' and condition_section=#{armyServiceState}
	</select>
	
	<select id="selectCity" resultMap="cityMap">
		select * from vi_city_code
	</select>
	
	<select id="selectArea" parameterType="integer" resultMap="areaMap">
		select * from vi_area_code where city_code = #{cityCode} order by name
	</select>
	
	<select id="selectCertification" parameterType="string" resultMap="certificateMap">
		select * from vi_certificate where name like CONCAT('%',#{name},'%')
	</select>
	
	<select id="selectLicensingDepartment" parameterType="integer" resultMap="licensingDepartmentMap">
		select * from vi_licensing_department where licensing_department_no= #{licensingDepartmentNo} 
	</select>
	
	<select id="selectBusinessType" resultMap="businessTypeMap">
		select * from vi_business_type
	</select>
	
	<select id="chooseBusinessType" parameterType="integer" resultMap="businessTypeMap">
		select business_content, (select business_content from vi_business_type where business_category = (select business_category from vi_business_type where business_no = #{businessNo}) and business_order=0) as business_type 
		from vi_business_type where business_no = #{businessNo}
	</select>
	
</mapper>